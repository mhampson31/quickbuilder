{% extends 'qb/base.html' %}
{% load qb_extras %}

{% block content %}
    <h1>Random Quick List</h1>

    <form action="{% url 'qb:random_quickbuild' %}" method="post">
        {% csrf_token %}
        {{form}}
        <input type="submit" value="Submit">
    </form>

    {% if 'build_list' %}
    <div id="'all_quickbuilds">
        {% for qb in build_list %}
            {% for build in qb.build_set.all %}
            <section class="quickbuild container list-group">

                <div class="row"> <!-- row 1 -->
                    <div class="col-md-3">
                        <h5>{{build.pilot}} <span class="border rounded">{{build.pilot.initiative}}</span></h5>
                    </div>

                    <div class="col-md-3">
                        <h5>{{build.pilot.ship}}</h5>
                    </div>
                </div> <!-- end row 1 -->

                <div class="row"> <!-- row 2 -->
                    <div class="col">
                        {% if build.front %}
                        <span class="border rounded icon">{{ "frontarc"|get_icon:"attack" }} {{build.front}}</span>
                        {% endif %}

                        {% if build.turret %}
                            <span class="border rounded icon">{{ "singleturretarc"|get_icon:"attack" }} {{build.turret}}</span>
                        {% endif %}

                        {% if build.doubleturret %}
                            <span class="border rounded icon">{{ "doubleturretarc"|get_icon:"attack" }} {{build.doubleturret}}</span>
                        {% endif %}

                        {% if build.full_front %}
                            <span class="border rounded icon">{{ "fullfrontarc"|get_icon:"attack" }} {{build.full_front}}</span>
                        {% endif %}

                            <span class="border rounded icon">{{ "agility"|get_icon:"agility" }} {{build.agility}}</span>

                        {% if build.shields %}
                            <span class="border rounded icon">{{ "shield"|get_icon:"shields" }} {{build.shields}}</span>
                        {% endif %}

                            <span class="border rounded icon">{{ "hull"|get_icon:"hull" }} {{build.hull}}</span>

                        {% if build.force %}
                            <span class="border rounded icon">{{ "forcecharge"|get_icon:"force" }} {{build.force}}</span>
                        {% endif %}

                        {% if build.pilot.ship.charge %}
                            <span class="border rounded icon">{{ "charge"|get_icon:"charge" }} {{build.pilot.ship.charge}}
                            {% if build.pilot.ship.charge_regen %} {{"recurring"|get_icon:"charge"}}{% endif %}</span>
                        {% endif %}
                    </div>
                </div>

                <div class="row">

                    <div class="col"> <!-- action sidebar -->
                        {% for action in build.action_bar %}
                            <span>{{action.display_name|safe}}</span>
                        {% endfor %}
                    </div>

                </div> <!-- end row 2 -->

                <div class="row"> <!-- row 3 -->
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">Ability</th>
                                <th scope="col">Description</th>
                                <th scope="col">Charges</th>
                            </tr>
                        </thead>

                        <tbody>
                            {% if build.pilot.ability %}
                            <tr>
                                <td class="text-nowrap">{{build.pilot.display_name}}</td>
                                <td>{{ build.pilot.ability|iconize|safe }}</td>
                                <td>
                                    {% if build.pilot.charge %}
                                    {{ build.pilot.charge|iconize|safe }}{% if build.pilot.charge_regen %}{{ "recurring"|iconize|safe }}{% endif %}
                                    {% endif %}
                                </td>
                            </tr>
                            {% endif %}

                            {% if build.pilot.ship.ability_title %}
                            <tr>
                                <td class="text-nowrap">{{ build.pilot.ship.ability_title }}{{ build.pilot.ship.icon|safe }}</th>
                                <td>{{ build.pilot.ship.ability|iconize|safe }}</td>
                                <td></td>
                            </tr>
                            {% endif %}

                            {% for upgrade in build.upgrades.all %}
                            <tr>
                                <td class="text-nowrap">
                                    {{upgrade}}
                                    {{upgrade.get_slot_display|get_icon|safe}}
                                    {% if upgrade.slot2 %}
                                    {{upgrade.get_slot_display|get_icon|safe}}
                                    {% endif %}
                                </th>
                                <td>
                                    {% if upgrade.ability2 %}<i>[Side 1]</i>{% endif %}
                                    {% if upgrade.ability %}
                                        {{ upgrade.ability|iconize|safe }}
                                        {% if upgrade.side_actions_1 %}
                                            {% if upgrade.ability %}<br />{% endif %}Grants {{upgrade.side_actions_1|join:", "|safe}}.
                                        {% endif %}
                                    {% endif %}
                                    {% if upgrade.ability2 %}
                                        <br />
                                        <i>[Side 2]</i>
                                        {{ upgrade.ability2|iconize|safe }}
                                        {% if upgrade.side_actions_2 %}
                                        <br />Grants {{upgrade.side_actions_2|join:", "|safe}}
                                        {% endif %} <!-- end ability2 -->
                                    {% endif %}
                                </td>
                                <td>
                                    {% if upgrade.charge %}
                                    {{upgrade.charge}}{% if build.pilot.charge_regen %} {{ "recurring"|iconize|safe }}{% endif %}
                                    {% endif %}
                                </td>

                            </tr>
                            {% endfor %} <!-- end upgrades -->
                        </tbody>
                    </table>
                </div>

            </section> <!-- end build -->
            {% endfor %} <!-- end builds -->

        {% endfor %} <!-- end quickbuilds -->
    </div>

    <!-- build table -->
    <div class="row">
    <!--    <h4>Threat {{qb.threat}} quick build with {{qb.pilot_names}}</h4> -->

    </div>

    {% endif %} <!-- end build_list -->
{% endblock %}