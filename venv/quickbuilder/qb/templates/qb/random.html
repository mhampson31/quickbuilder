{% extends 'qb/base.html' %}
{% load qb_extras %}

{% block content %}
    <h1>Random Quick List</h1>

    <form action="{% url 'qb:random_quickbuild' %}" method="post">
        {% csrf_token %}
        {{form}}
        <input type="submit" value="Submit">
    </form>

    {% if 'build_list' %}
    <div id="'all_quickbuilds">
        {% for qb in build_list %}
            {% for build in qb.build_set.all %}
            <section class="quickbuild container list-group">

                <div class="row"> <!-- row 1 -->
                    <div class="col-md-3">
                        <h5>{{build.pilot}}</h5>
                    </div>

                    <div class="col-md-3">
                        <h5>{{build.pilot.ship}}</h5>
                    </div>

                    <div class="col-md-3">
                        Initiative {{build.pilot.initiative}}
                    </div>
                </div> <!-- end row 1 -->

                <div class="row"> <!-- row 2 -->
                    <div class="col">
                        {% if build.pilot.ship.front %}
                        <span class="icon">{{ "frontarc"|get_icon:"attack" }} {{build.pilot.ship.front}}</span>
                        {% endif %}

                        {% if build.pilot.ship.turret %}
                            <span class="icon">{{ "singleturretarc"|get_icon:"attack" }} {{build.pilot.ship.turret}}</span>
                        {% endif %}

                        {% if build.pilot.ship.doubleturret %}
                            <span class="icon">{{ "doubleturretarc"|get_icon:"attack" }} {{build.pilot.ship.doubleturret}}</span>
                        {% endif %}

                        {% if build.pilot.ship.full_front %}
                            <span class="icon">{{ "fullfrontarc"|get_icon:"attack" }} {{build.pilot.ship.full_front}}</span>
                        {% endif %}

                            <span class="icon">{{ "agility"|get_icon:"agility" }} {{build.pilot.ship.agility}}</span>

                        {% if build.pilot.ship.shields %}
                            <span class="icon">{{ "shield"|get_icon:"shields" }} {{build.pilot.ship.shields}}</span>
                        {% endif %}

                            <span class="icon">{{ "hull"|get_icon:"hull" }} {{build.pilot.ship.hull}}</span>

                        {% if build.pilot.ship.force %}
                            <span class="icon">{{ "forcecharge"|get_icon:"force" }} {{build.pilot.ship.force}}</span>
                        {% endif %}

                        {% if build.pilot.ship.charge %}
                            <span class="icon">{{ "charge"|get_icon:"charge" }} {{build.pilot.ship.charge}}
                            {% if build.pilot.ship.charge_regen %} {{"recurring"|get_icon:"charge"}}{% endif %}</span>
                        {% endif %}
                    </div>
                </div> <!-- end row 2 -->

                <div class="row"> <!-- row 3 -->
                    <div class="col-md-1"> <!-- action sidebar -->
                        {% for action in build.action_bar %}
                        <div class="row">
                            {{action.display_name|safe}}
                        </div>
                        {% endfor %}
                    </div>

                    <div class="col"> <!-- abilities sub-rows -->
                        <div class="row list-item pilot">
                            <div class="col-md-3">

                            </div>
                            <div class="col-md-9">
                                {{ build.pilot.ability }}
                            </div>
                        </div>

                        {% if build.pilot.ship.ability_title %}
                        <div class="row list-item ship_ability">
                            <div class="col-md-3">
                                {{build.pilot.ship.ability_title}}
                                {{build.pilot.ship.icon|safe}}
                            </div>
                            <div class="col-md-9">
                                {{ build.pilot.ship.ability }}
                            </div>
                        </div>
                        {% endif %}

                        {% for upgrade in build.upgrades.all %}
                        <div class="row list-item ship_upgrade">
                            <div class="col-md-3">
                                {{upgrade}}
                                {{upgrade.get_slot_display|get_icon|safe}}
                                {% if upgrade.slot2 %}
                                    {{upgrade.get_slot_display|get_icon|safe}}
                                {% endif %}
                            </div>
                            <div class="col-md-9">
                            {% if upgrade.ability2 %}<i>[Side 1]</i>{% endif %}
                                {{ upgrade.ability }}
                                {% if upgrade.side_actions_1 %}
                                    <br />Grants {{upgrade.side_actions_1|join:", "|safe}}
                                {% endif %}
                                {% if upgrade.ability2 %}
                                    <br />
                                    <i>[Side 2]</i>
                                    {{ upgrade.ability2 }}
                                    {% if upgrade.side_actions_2 %}
                                    <br />Grants {{upgrade.side_actions_2|join:", "|safe}}
                                    {% endif %} <!-- end ability2 -->
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %} <!-- end upgrades -->
                    </div>
                </div>

            </section> <!-- end build -->
            {% endfor %} <!-- end builds -->

        {% endfor%} <!-- end quickbuilds -->
    </div>

    <!-- build table -->
    <div class="row">
    <!--    <h4>Threat {{qb.threat}} quick build with {{qb.pilot_names}}</h4> -->

    </div>

    {% endif %} <!-- end build_list -->
{% endblock %}